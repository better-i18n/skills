# GitHub Sync

Synchronize translations with your GitHub repository.

## Overview

GitHub Sync provides:
- Automatic key discovery from your codebase
- Two-way synchronization
- Pull request workflow for translation changes
- Version-controlled translation history

## Setup

### 1. Install GitHub App

```
Project Settings → Integrations → GitHub → Install App
```

Select repositories to grant access.

### 2. Connect Repository

```
Project Settings → GitHub → Connect Repository

Repository: your-org/your-repo
Branch: main
Path: locales/
```

### 3. Configure File Pattern

```json
{
  "sourcePattern": "locales/en/**/*.json",
  "targetPattern": "locales/{locale}/**/*.json"
}
```

## Sync Modes

### Pull (Import)

Import translations from GitHub to Better i18n.

```
Source code changes → Webhook → Better i18n imports keys
```

**Triggers:**
- Push to configured branch
- Manual sync from dashboard

### Push (Export)

Export translations from Better i18n to GitHub.

```
Translations approved → PR created → Merge → Code updated
```

**Options:**
- Create PR (recommended)
- Direct commit (for automated workflows)

## File Format Detection

Better i18n auto-detects your structure:

| Structure | Detection | Example |
|-----------|-----------|---------|
| Flat | Single file per locale | `en.json`, `tr.json` |
| Namespaced | Folder per locale | `en/common.json` |
| Nested | Namespace in file | `{"common": {...}}` |

### Flat JSON

```
locales/
├── en.json    → Source
├── tr.json    → Target
└── de.json    → Target
```

```json
// en.json
{
  "welcome": "Welcome",
  "goodbye": "Goodbye"
}
```

### Namespaced JSON

```
locales/
├── en/
│   ├── common.json
│   └── auth.json
└── tr/
    ├── common.json
    └── auth.json
```

### Nested JSON

```json
// en.json
{
  "common": {
    "welcome": "Welcome"
  },
  "auth": {
    "login": "Sign In"
  }
}
```

## Sync Workflow

### Initial Import

1. Connect repository
2. Better i18n scans for translation files
3. Keys extracted and created
4. Source texts imported
5. Existing translations preserved

### Ongoing Sync

```
Developer adds key → Push → Webhook fires → Key appears in dashboard
                                                    ↓
Translator adds translation → Approve → Publish → PR created
                                                    ↓
                                            Merge PR → Done
```

## Pull Request Settings

### PR Configuration

```
Project Settings → GitHub → Pull Requests

Title template: "chore(i18n): Update {locale} translations"
Branch prefix: "i18n/"
Auto-merge: Off (recommended)
Reviewers: @translation-team
```

### PR Content

```markdown
## Translation Updates

This PR updates translations for: **Turkish (tr)**

### Changes
- `common.json`: 5 keys updated
- `auth.json`: 2 new keys

### Review Checklist
- [ ] Translations are accurate
- [ ] No placeholder issues
- [ ] Consistent terminology

---
*Generated by Better i18n*
```

## Conflict Resolution

### When Conflicts Occur

1. Same key modified in both GitHub and Better i18n
2. File structure changed in GitHub
3. Key deleted in code but has translations

### Resolution Strategy

```
Project Settings → Sync → Conflict Resolution

Options:
- Better i18n wins (dashboard is source of truth)
- GitHub wins (code is source of truth)
- Manual review (pause and notify)
```

## Webhook Events

### Supported Events

| Event | Action |
|-------|--------|
| `push` | Scan for new/changed keys |
| `pull_request.merged` | Mark translations as deployed |
| `delete` | Handle removed files |

### Webhook URL

```
https://api.better-i18n.com/webhooks/github/{project_id}
```

### Verifying Webhooks

All webhooks are verified using GitHub's HMAC-SHA256 signature.

## Branch Strategy

### Recommended Setup

```
main (production)
  └── develop
       └── feature/add-checkout-flow
```

Configure sync for `main` branch only. Feature branches sync manually.

### Multi-Environment

```
Project: my-app-production → main branch
Project: my-app-staging → develop branch
```

## Troubleshooting

### "Webhook not received"

1. Check GitHub App permissions
2. Verify webhook URL is correct
3. Check webhook delivery logs in GitHub

### "Keys not importing"

1. Verify file pattern matches your structure
2. Check JSON is valid
3. Ensure source language file exists

### "PR not created"

1. Check GitHub App has write access
2. Verify branch protection allows bot PRs
3. Check for existing open PR (one at a time)

### "Sync stuck"

```
Project Settings → Sync → View Jobs → Cancel stuck job
```

## Best Practices

1. **Use feature branches** - Don't sync experimental keys
2. **Review PRs** - Have translators review before merge
3. **Keep JSON valid** - Lint before commit
4. **Document patterns** - In CONTRIBUTING.md
5. **Set up CI** - Validate translation files in CI
